---
const BASE = import.meta.env.BASE_URL || '/';
---
<nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
  <div class="container px-4 px-lg-5">
    <a class="navbar-brand" href={BASE}>æ´›ç©¹åçš„ä¸€å®¶è¨€</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
      aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ms-auto py-4 py-lg-0">
        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href={BASE}>Home</a></li>
        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href=`${BASE}about/`>About</a></li>
        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href=`${BASE}articles/`>Articles</a></li>
        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href=`${BASE}contact/`>Contact</a></li>
        <li class="nav-item ms-lg-3 theme-toggle-item">
          <button class="btn btn-sm theme-toggle" type="button" id="themeToggle" aria-pressed="false" title="Toggle theme">
            ğŸŒ™
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script is:inline>
(() => {
  if (typeof window === 'undefined') return;
  const KEY = 'theme-preference';
  const root = document.documentElement;
  const btn = document.getElementById('themeToggle');
  if (!btn) return;

  const apply = (mode) => {
    const isDark = mode === 'dark';
    root.classList.toggle('theme-dark', isDark);
    btn.setAttribute('aria-pressed', String(isDark));
    btn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
  };

  const stored = localStorage.getItem(KEY);
  const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  let mode = stored || (systemPrefersDark ? 'dark' : 'light');
  apply(mode);

  btn.addEventListener('click', () => {
    mode = mode === 'dark' ? 'light' : 'dark';
    localStorage.setItem(KEY, mode);
    apply(mode);
  });
})();
</script>

<style>
  /* Theme toggle button */
  .theme-toggle {
    border: 1px solid var(--bs-border-color, #dee2e6);
    background: transparent;
    padding: 0.45rem 0.8rem;
    line-height: 1;
    font-size: 0.95rem;
    border-radius: 999px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .theme-toggle:hover {
    background: rgba(255, 255, 255, 0.08);
  }

  /* Align the toggle vertically within the navbar */
  .theme-toggle-item {
    display: flex;
    align-items: center;
  }

  /* Dark theme variables (applies globally when html has .theme-dark) */
  :global(html.theme-dark) {
    color-scheme: dark;
    --bs-body-bg: #000000;
    --bs-body-color: #e5e7eb;
    --bs-link-color: #e5e7eb;
    --bs-link-hover-color: #fe54ac;
    --bs-border-color: #262626;
    --bs-border-color-translucent: rgba(255, 255, 255, 0.893);
    --bs-primary: #facc15;
    --bs-highlight-bg: rgba(250, 204, 21, 0.16);
    --bs-code-color: #fbbf24;
  }

  :global(html.theme-dark body) {
    background-color: var(--bs-body-bg);
    color: var(--bs-body-color);
  }

  :global(html.theme-dark a) {
    color: var(--bs-link-color);
  }
  :global(html.theme-dark a:hover) {
    color: var(--bs-link-hover-color);
  }

  /* Navbar adjustments in dark mode */
  :global(html.theme-dark #mainNav) {
    background-color: rgba(0, 0, 0, 0.82);
    border-bottom-color: #262626;
  }
  :global(html.theme-dark #mainNav .navbar-brand),
  :global(html.theme-dark #mainNav .nav-link) {
    color: #3b3b3b;
  }
  :global(html.theme-dark #mainNav .navbar-brand:hover),
  :global(html.theme-dark #mainNav .nav-link:hover) {
    color: #ffffff;
  }

  /* Force nav links to Capitalize instead of uppercase */
  :global(#mainNav .navbar-nav > li.nav-item > a.nav-link) {
    text-transform: none;
  }
  :global(html.theme-dark #mainNav.is-fixed) {
    background-color: rgba(0, 0, 0, 0.404);
    border-bottom-color: #262626;
  }

  /* Code blocks / highlight background tweaks */
  :global(html.theme-dark mark),
  :global(html.theme-dark .mark) {
    background-color: var(--bs-highlight-bg);
    color: inherit;
  }

  /* Buttons inherit in dark mode */
  :global(html.theme-dark .btn-outline-light) {
    color: #e2e8f0;
    border-color: #e2e8f0;
  }
  :global(html.theme-dark .btn-outline-light:hover) {
    background: #e2e8f0;
    color: #000000;
  }
</style>
